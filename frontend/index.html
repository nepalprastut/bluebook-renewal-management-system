<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Vehicle List</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

<nav>
  <h2>Bluebook Renewal</h2>
  <a href="index.html" class="active"><i class="fas fa-car"></i> Vehicles</a>
  <a href="renewals.html"><i class="fas fa-history"></i> Renewal History</a>
</nav>

<main>
  <header>
    <h1>Registered Vehicles</h1>
    <a href="add_vehicle.html" class="btn-add">+ Add Vehicle</a>
  </header>

  <div class="stats-grid">
    <div class="stat-card">
      <h3>Total Vehicles</h3>
      <p id="totalCount">0</p>
    </div>
    <div class="stat-card">
      <h3>Active</h3>
      <p id="activeCount" style="color: var(--success)">0</p>
    </div>
    <div class="stat-card">
      <h3>Expired</h3>
      <p id="alertCount" style="color: var(--danger)">0</p>
    </div>
  </div>

  <div class="card">
    <table>
      <thead>
        <tr>
          <th>Owner</th>
          <th>Plate No</th>
          <th>Type</th>
          <th>Expiry Date</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="vehicleTable"></tbody>
    </table>
  </div>
</main>

<script>
function formatDate(d) {
  if (!d) return "-";
  return new Date(d).toISOString().split("T")[0];
}

async function loadVehicles() {
  const res = await fetch("/api/vehicles");
  const data = await res.json();

  document.getElementById("totalCount").innerText = data.length;

  let active = 0;
  const table = document.getElementById("vehicleTable");
  table.innerHTML = "";

  data.forEach(v => {
    const expired = v.status?.toLowerCase() === "expired";
    if (!expired) active++;

    table.innerHTML += `
      <tr>
        <td><strong>${v.full_name}</strong></td>
        <td>${v.plate_no}</td>
        <td>${v.vehicle_type}</td>
        <td>${formatDate(v.expiry_date)}</td>
        <td>
          <span class="status-pill ${expired ? "status-expired" : "status-active"}">
            ${v.status ?? "Pending"}
          </span>
        </td>
      </tr>
    `;
  });

  document.getElementById("activeCount").innerText = active;
  document.getElementById("alertCount").innerText = data.length - active;
}

loadVehicles();
</script>

</body>
</html>